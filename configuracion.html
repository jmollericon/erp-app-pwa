<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Erp App</title>
  <link rel="shortcut icon" href="./assets/images/code.png" type="image/x-icon">
  <link rel="manifest" href="./manifest.json">

  <!-- Bootstrap 4.0.0 - css -->
  <link rel="stylesheet" href="./assets/plugins/bootstrap/4.0.0/css/bootstrap.min.css">
  <!-- Font Awesome 4.7.0 - css -->
  <link rel="stylesheet" href="./assets/plugins/font-awesome-4.7.0/css/font-awesome.min.css">
  <!-- Erp App PWA 1.0.0 - css -->
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <div class="row text-center">
    <div class="col-md-12">
      <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="./home.html">
          <img src="./assets/images/code.png" alt="Logo App" height="30px">&nbsp; APP
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarText">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" href="./home.html"><i class="fa fa-home"></i>&nbsp; Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#"><i class="fa fa-map-marker"></i>&nbsp; Direcciones de pago</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#"><i class="fa fa-phone"></i>&nbsp; Contactos</a>
            </li>
            <li class="nav-item opcion_user_adm">
              <a class="nav-link" href="./registro_lectura.html"><i class="fa fa-pencil"></i>&nbsp; Registro de lecturas</a>
            </li>
            <li class="nav-item active opcion_user_adm">
              <a class="nav-link" href="./configuracion.html"><i class="fa fa-cog"></i>&nbsp; Configuración</a>
            </li>
          </ul>
          <span class="navbar-text">
            <li class="nav-item dropdown logout">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fa fa-user-o"></i>&nbsp;&nbsp;<span id="sesion_name"></span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" id="btn_logout" href="#">&nbsp;&nbsp;Cerrar Sesión</a>
              </div>
            </li>
          </span>
        </div>
      </nav>
      <span><strong>Tipo usuario: </strong><span id="sesion_user_type"></span></span><br>
      <h5>Configuraciones</h5>
    </div>
  </div>
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <span>Actualización de datos: </span><br />
      </div>
      <div class="col-md-12 text-center">
        <button type="button" id="btn_actualizar_datos" class="btn btn-info btn-sm"><i class="fa fa-refresh"></i> Actualizar direcciones</button><br />
        <small class="color_uno">Circuitos, Zonas y Calles</small><br />
        <small class="color_uno">Ultima actualización: 12/12/2020 12:22:09</small>
      </div>
    </div>
    <div class="row mt-2">
      <div class="col-md-12">
        <ul class="nav nav-tabs justify-content-center">
          <li class="nav-item">
            <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Circuitos</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Zonas</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">Calles</a>
          </li>
        </ul>
        <div class="tab-content" id="myTabContent">
          <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
            <div class="contenedor_datos">
              <div id="contenedor_circuitos">
                <!-- dinamico -->
              </div>
            </div>
          </div>
          <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
            <div class="contenedor_datos">
              <div id="contenedor_zonas">
                <!-- dinamico -->
              </div>
            </div>
          </div>
          <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
            <div class="contenedor_datos">
              <div id="contenedor_calles">
                <!-- dinamico -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- Modal Nuevo Registro-->
<div class="modal fade" id="modal_nuevo_registro" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Nuevo registro</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form action="#" id="form_nuevo_registro">
          <div class="row">
            <div class="col-md-12">
              <label for="registro_anio_mes">Mes</label>
              <input type="month" id="registro_anio_mes" class="form-control" required>
            </div>
          </div>
          <div class="row mt-3">
            <div class="col-md-12 text-center">
              <button type="submit" class="btn btn-primary btn-sm">Registrar</button>
              <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cancelar</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

  <!-- JQuery 3.5.1 - js -->
  <script src="./assets/plugins/jquery/3.5.1/jquery.min.js"></script>
  <!-- Bootstrap 4.0.0 - js -->
  <script src="./assets/plugins/bootstrap/4.0.0/js/popper.min.js"></script>
  <script src="./assets/plugins/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <!-- SweetAlert2 - js -->
  <script src="./assets/plugins/sweetalert2/sweetalert2@10.js"></script>
  <!-- Erp App PWA 1.0.0 - js -->
  <script src="app.js"></script> <!-- Execute ServiceWorker -->
  <script src="./js/indexedDB_registro_lectura.js"></script>

  <script>
    // Cerrar Sesión
    $('#btn_logout').on('click', function (e) {
      e.preventDefault();
      eliminar_data_sesion();
    });
    $('#form_nuevo_registro').submit(function (e) {
      e.preventDefault();
      const anio_mes = $('#registro_anio_mes').val();
      console.log('registrando', anio_mes);
    });
    function registrar_lectura_mes(anio_mes) {
      console.log('registrando del mes', anio_mes)
    }
    // Actualizar Circuitos, Zonas y Calles en IndexedDB
    $('#btn_actualizar_datos').on('click', function () {
      Swal.fire({
        html: 'Actualizando datos',
        allowOutsideClick: false // evitar que se cierre si se hace click fuera del modal
      });
      Swal.showLoading();
      $.ajax({
        type: "get",
        url: BASE_URL+"rest/App/direcciones",
        dataType: "json",
        success: async function (response) {
          const res = await almacenar_direcciones_indexedDB(response);
          await renderizar_direcciones_desde_indexedDB();
          console.log('res almacenar dir into indexedDB', res)
          Swal.close();
          time_alert('success', '', 'Actualizado.', 2000)
        }
      });
    });
  </script>
</body>
</html>